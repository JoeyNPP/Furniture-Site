{"ast":null,"code":"import axios from \"axios\";\nimport { updateProduct } from \"./api\"; // ‚úÖ Ensures last_sent tracking works\n\nconst API_URL = \"https://api.kit.com/v4/broadcasts\";\nconst API_KEY = \"kit_a0a183e8fd744ca557d96126e488ae22\";\nconst headers = {\n  Accept: \"application/json\",\n  \"Content-Type\": \"application/json\",\n  \"X-Kit-Api-Key\": API_KEY\n};\n\n/**\r\n * ‚úÖ Send Individual Emails & Ensure last_sent is updated correctly\r\n */\nexport async function sendIndividualEmails(selectedProducts) {\n  if (!selectedProducts || selectedProducts.length === 0) {\n    console.error(\"No products selected for individual email.\");\n    return;\n  }\n  for (const product of selectedProducts) {\n    if (!(product !== null && product !== void 0 && product.id)) {\n      console.error(\"Skipping product with no ID:\", product);\n      continue;\n    }\n\n    // Instead of calling Kit API, call the FastAPI backend\n    const localUrl = `http://127.0.0.1:8000/products/${product.id}/send-email/`;\n    console.log(`üîπ Sending individual email via FastAPI: POST ${localUrl}`);\n    try {\n      const response = await fetch(localUrl, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      });\n      if (!response.ok) {\n        const errText = await response.text();\n        console.error(`‚ùå Failed to send single email for ID ${product.id}:`, errText);\n      } else {\n        const data = await response.json();\n        console.log(`‚úÖ Email & last_sent updated for ID ${product.id}:`, data);\n      }\n    } catch (error) {\n      console.error(\"‚ùå Network error sending single email:\", error);\n    }\n  }\n}\n\n/**\r\n * ‚úÖ Send Group Email & Ensure last_sent is updated correctly\r\n */\nexport async function sendGroupEmail(selectedProducts) {\n  if (!selectedProducts || selectedProducts.length === 0) {\n    console.error(\"No products selected for group email.\");\n    return;\n  }\n\n  // Grab array of IDs for your group route\n  const productIds = selectedProducts.map(p => p.id).filter(Boolean);\n  if (!productIds.length) {\n    console.error(\"Skipping group email, invalid product IDs.\");\n    return;\n  }\n  const localUrl = \"http://127.0.0.1:8000/products/send-group-email/\";\n  console.log(`üîπ Sending group email via FastAPI: POST ${localUrl}`, productIds);\n  try {\n    const response = await fetch(localUrl, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(productIds)\n    });\n    if (!response.ok) {\n      const errText = await response.text();\n      console.error(\"‚ùå Failed to send group email:\", errText);\n    } else {\n      const data = await response.json();\n      console.log(`‚úÖ Group email & last_sent updated for IDs ${productIds}:`, data);\n    }\n  } catch (error) {\n    console.error(\"‚ùå Network error sending group email:\", error);\n  }\n}\n\n/**\r\n * ‚úÖ Build the Email EXACTLY Like Python Code\r\n */\nfunction buildPythonStyleEmail({\n  subject,\n  amazonUrl,\n  walmartUrl,\n  ebayUrl,\n  imageUrl,\n  price,\n  moq,\n  qty,\n  asin,\n  fob,\n  expDate,\n  leadTime\n}) {\n  return `\n    <html>\n      <head>\n        <style>\n          body {\n            font-family: Arial, sans-serif;\n            text-align: center;\n            margin: 0;\n            padding: 0;\n          }\n          .container {\n            width: 100%;\n            text-align: center; /* ‚úÖ Ensures all text and images are centered */\n            margin: 0 auto;\n          }\n          .content {\n            max-width: 600px;\n            padding: 20px;\n            margin: 0 auto;\n            text-align: center; /* ‚úÖ Forces text to center */\n          }\n          h2, p, img, a {\n            text-align: center; /* ‚úÖ Applies to all relevant elements */\n            display: block;\n            margin: 10px auto;\n          }\n          img {\n            max-width: 300px;\n            max-height: 300px;\n            object-fit: contain;\n          }\n          .button {\n            padding: 15px 25px;\n            font-size: 16px;\n            text-decoration: none;\n            border-radius: 5px;\n            margin: 5px;\n            display: inline-block;\n            color: white;\n          }\n          .amazon { background-color: #FF9900; }\n          .walmart { background-color: #0071CE; }\n          .ebay { background-color: #E53238; }\n          .details {\n            font-size: 18px;\n            margin: 10px 0;\n          }\n        </style>\n      </head>\n      <body>\n        <div class=\"container\">\n          <div class=\"content\">\n            <h2>${subject}</h2>\n            <img src=\"${imageUrl}\" alt=\"${subject}\" />\n\n            <div>\n              ${amazonUrl.includes(\"https\") ? `<a class=\"button amazon\" href=\"${amazonUrl}\">Amazon Link</a>` : \"\"}\n              ${walmartUrl.includes(\"https\") ? `<a class=\"button walmart\" href=\"${walmartUrl}\">Walmart Link</a>` : \"\"}\n              ${ebayUrl.includes(\"https\") ? `<a class=\"button ebay\" href=\"${ebayUrl}\">eBay Link</a>` : \"\"}\n            </div>\n\n            <p class=\"details\">$${price} EA, MOQ ${moq}, ${qty} Available.</p>\n            ${asin ? `<p class=\"details\">ASIN: ${asin}</p>` : \"\"}\n            ${fob ? `<p class=\"details\">FOB: ${fob}</p>` : \"\"}\n            ${expDate ? `<p class=\"details\">Expiration Date: ${expDate}</p>` : \"\"}\n            <p class=\"details\">Lead Time: ${leadTime}</p>\n          </div>\n        </div>\n      </body>\n    </html>\n  `;\n}","map":{"version":3,"names":["axios","updateProduct","API_URL","API_KEY","headers","Accept","sendIndividualEmails","selectedProducts","length","console","error","product","id","localUrl","log","response","fetch","method","ok","errText","text","data","json","sendGroupEmail","productIds","map","p","filter","Boolean","body","JSON","stringify","buildPythonStyleEmail","subject","amazonUrl","walmartUrl","ebayUrl","imageUrl","price","moq","qty","asin","fob","expDate","leadTime","includes"],"sources":["C:/Users/josep/Documents/NPP_Deals/frontend/src/emailSender.js"],"sourcesContent":["import axios from \"axios\";\r\nimport { updateProduct } from \"./api\"; // ‚úÖ Ensures last_sent tracking works\r\n\r\nconst API_URL = \"https://api.kit.com/v4/broadcasts\";\r\nconst API_KEY = \"kit_a0a183e8fd744ca557d96126e488ae22\";\r\n\r\nconst headers = {\r\n  Accept: \"application/json\",\r\n  \"Content-Type\": \"application/json\",\r\n  \"X-Kit-Api-Key\": API_KEY,\r\n};\r\n\r\n/**\r\n * ‚úÖ Send Individual Emails & Ensure last_sent is updated correctly\r\n */\r\nexport async function sendIndividualEmails(selectedProducts) {\r\n  if (!selectedProducts || selectedProducts.length === 0) {\r\n    console.error(\"No products selected for individual email.\");\r\n    return;\r\n  }\r\n\r\n  for (const product of selectedProducts) {\r\n    if (!product?.id) {\r\n      console.error(\"Skipping product with no ID:\", product);\r\n      continue;\r\n    }\r\n\r\n    // Instead of calling Kit API, call the FastAPI backend\r\n    const localUrl = `http://127.0.0.1:8000/products/${product.id}/send-email/`;\r\n    console.log(`üîπ Sending individual email via FastAPI: POST ${localUrl}`);\r\n\r\n    try {\r\n      const response = await fetch(localUrl, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      });\r\n      if (!response.ok) {\r\n        const errText = await response.text();\r\n        console.error(`‚ùå Failed to send single email for ID ${product.id}:`, errText);\r\n      } else {\r\n        const data = await response.json();\r\n        console.log(`‚úÖ Email & last_sent updated for ID ${product.id}:`, data);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"‚ùå Network error sending single email:\", error);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * ‚úÖ Send Group Email & Ensure last_sent is updated correctly\r\n */\r\nexport async function sendGroupEmail(selectedProducts) {\r\n  if (!selectedProducts || selectedProducts.length === 0) {\r\n    console.error(\"No products selected for group email.\");\r\n    return;\r\n  }\r\n\r\n  // Grab array of IDs for your group route\r\n  const productIds = selectedProducts.map((p) => p.id).filter(Boolean);\r\n  if (!productIds.length) {\r\n    console.error(\"Skipping group email, invalid product IDs.\");\r\n    return;\r\n  }\r\n\r\n  const localUrl = \"http://127.0.0.1:8000/products/send-group-email/\";\r\n  console.log(`üîπ Sending group email via FastAPI: POST ${localUrl}`, productIds);\r\n\r\n  try {\r\n    const response = await fetch(localUrl, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify(productIds),\r\n    });\r\n    if (!response.ok) {\r\n      const errText = await response.text();\r\n      console.error(\"‚ùå Failed to send group email:\", errText);\r\n    } else {\r\n      const data = await response.json();\r\n      console.log(`‚úÖ Group email & last_sent updated for IDs ${productIds}:`, data);\r\n    }\r\n  } catch (error) {\r\n    console.error(\"‚ùå Network error sending group email:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * ‚úÖ Build the Email EXACTLY Like Python Code\r\n */\r\nfunction buildPythonStyleEmail({\r\n  subject,\r\n  amazonUrl,\r\n  walmartUrl,\r\n  ebayUrl,\r\n  imageUrl,\r\n  price,\r\n  moq,\r\n  qty,\r\n  asin,\r\n  fob,\r\n  expDate,\r\n  leadTime,\r\n}) {\r\n  return `\r\n    <html>\r\n      <head>\r\n        <style>\r\n          body {\r\n            font-family: Arial, sans-serif;\r\n            text-align: center;\r\n            margin: 0;\r\n            padding: 0;\r\n          }\r\n          .container {\r\n            width: 100%;\r\n            text-align: center; /* ‚úÖ Ensures all text and images are centered */\r\n            margin: 0 auto;\r\n          }\r\n          .content {\r\n            max-width: 600px;\r\n            padding: 20px;\r\n            margin: 0 auto;\r\n            text-align: center; /* ‚úÖ Forces text to center */\r\n          }\r\n          h2, p, img, a {\r\n            text-align: center; /* ‚úÖ Applies to all relevant elements */\r\n            display: block;\r\n            margin: 10px auto;\r\n          }\r\n          img {\r\n            max-width: 300px;\r\n            max-height: 300px;\r\n            object-fit: contain;\r\n          }\r\n          .button {\r\n            padding: 15px 25px;\r\n            font-size: 16px;\r\n            text-decoration: none;\r\n            border-radius: 5px;\r\n            margin: 5px;\r\n            display: inline-block;\r\n            color: white;\r\n          }\r\n          .amazon { background-color: #FF9900; }\r\n          .walmart { background-color: #0071CE; }\r\n          .ebay { background-color: #E53238; }\r\n          .details {\r\n            font-size: 18px;\r\n            margin: 10px 0;\r\n          }\r\n        </style>\r\n      </head>\r\n      <body>\r\n        <div class=\"container\">\r\n          <div class=\"content\">\r\n            <h2>${subject}</h2>\r\n            <img src=\"${imageUrl}\" alt=\"${subject}\" />\r\n\r\n            <div>\r\n              ${amazonUrl.includes(\"https\") ? `<a class=\"button amazon\" href=\"${amazonUrl}\">Amazon Link</a>` : \"\"}\r\n              ${walmartUrl.includes(\"https\") ? `<a class=\"button walmart\" href=\"${walmartUrl}\">Walmart Link</a>` : \"\"}\r\n              ${ebayUrl.includes(\"https\") ? `<a class=\"button ebay\" href=\"${ebayUrl}\">eBay Link</a>` : \"\"}\r\n            </div>\r\n\r\n            <p class=\"details\">$${price} EA, MOQ ${moq}, ${qty} Available.</p>\r\n            ${asin ? `<p class=\"details\">ASIN: ${asin}</p>` : \"\"}\r\n            ${fob ? `<p class=\"details\">FOB: ${fob}</p>` : \"\"}\r\n            ${expDate ? `<p class=\"details\">Expiration Date: ${expDate}</p>` : \"\"}\r\n            <p class=\"details\">Lead Time: ${leadTime}</p>\r\n          </div>\r\n        </div>\r\n      </body>\r\n    </html>\r\n  `;\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}