{"ast":null,"code":"// C:\\Users\\josep\\Documents\\NPP_Deals\\frontend\\src\\emailSender.js\n\nimport axios from \"axios\";\n\n/**\r\n * 1) Direct Kit.com broadcast endpoints\r\n *    (like your original Python -> https://api.kit.com/v4/broadcasts)\r\n */\nconst API_URL = \"https://api.kit.com/v4/broadcasts\";\nconst API_KEY = \"kit_a0a183e8fd744ca557d96126e488ae22\";\nconst headers = {\n  Accept: \"application/json\",\n  \"Content-Type\": \"application/json\",\n  \"X-Kit-Api-Key\": API_KEY\n};\n\n// ========== 2) buildEmailBody(product) ==========\n//   Incorporates the HTML + <style> from your Python snippet\n//   so each product is centered, with the same background styling, \n//   image, and brand-colored buttons.\nfunction buildEmailBody(product) {\n  const title = (product.title || \"\").trim();\n  const imageUrl = product.image_url || \"\";\n  const amazonUrl = product.amazon_url || \"\";\n  const walmartUrl = product.walmart_url || \"\";\n  const ebayUrl = product.ebay_url || \"\";\n  const price = product.price ? parseFloat(product.price).toFixed(2) : \"0.00\";\n  const moq = product.moq || \"0\";\n  const qty = product.qty || \"0\";\n  const asin = product.asin || \"\";\n  const fob = product.fob || \"\";\n  const expDate = product.exp_date || \"\";\n  let leadTime = product.lead_time || \"\";\n\n  // Convert \"Days\" -> \"Business Days\"\n  if (leadTime.includes(\"Days\")) {\n    leadTime = leadTime.replace(\"Days\", \"Business Days\");\n  }\n\n  // EXACT inline styling from your Python approach:\n  // <html> ... <style> ... <body> ... so that Kit won't strip it.\n  const emailBody = `\n    <html>\n      <head>\n        <style>\n          body { font-family: Arial, sans-serif; text-align: center; }\n          .container { padding: 20px; }\n          .product-title { font-size: 18px; margin-bottom: 20px; }\n          .product-image { max-width: 300px; max-height: 300px; object-fit: contain; margin: 40px auto; display: block; }\n          .button { padding: 15px 25px; font-size: 16px; text-decoration: none; border-radius: 5px; margin: 5px; display: inline-block; color: white; }\n          .amazon { background-color: #FF9900; }\n          .walmart { background-color: #0071CE; }\n          .ebay { background-color: #E53238; }\n        </style>\n      </head>\n      <body>\n        <div class=\"container\">\n          <h2 class=\"product-title\">${title}</h2>\n          <img class=\"product-image\" src=\"${imageUrl}\" alt=\"${title}\" />\n\n          ${amazonUrl.includes(\"https\") ? `<a class=\"button amazon\" href=\"${amazonUrl}\">Amazon Link</a>` : \"\"}\n          ${walmartUrl.includes(\"https\") ? `<a class=\"button walmart\" href=\"${walmartUrl}\">Walmart Link</a>` : \"\"}\n          ${ebayUrl.includes(\"https\") ? `<a class=\"button ebay\" href=\"${ebayUrl}\">eBay Link</a>` : \"\"}\n\n          <p>$${price} EA, MOQ ${moq}, ${qty} Available.</p>\n          ${asin ? `<p>ASIN: ${asin}</p>` : \"\"}\n          ${fob ? `<p>FOB: ${fob}</p>` : \"\"}\n          ${expDate ? `<p>Expiration Date: ${expDate}</p>` : \"\"}\n          <p>Lead Time: ${leadTime}</p>\n        </div>\n      </body>\n    </html>\n  `;\n  return emailBody;\n}\n\n// ========== 3) sendIndividualEmails(selectedProducts) ==========\n//   Loops each product => buildEmailBody => call Kit API for each\n//   If you want to track last_sent, call a local server after success, \n//   but this snippet only hits Kit.com\nexport async function sendIndividualEmails(selectedProducts) {\n  if (!selectedProducts || selectedProducts.length === 0) {\n    console.error(\"No products selected for individual email.\");\n    return;\n  }\n  for (const product of selectedProducts) {\n    if (!product || !product.title) {\n      console.error(\"Skipping invalid product (missing title):\", product);\n      continue;\n    }\n\n    // Build the fancy HTML for this product\n    const html = buildEmailBody(product);\n\n    // Kit.com broadcast payload\n    const emailData = {\n      subject: product.title,\n      content: html,\n      public: false,\n      // Draft mode\n      email_template_id: null // default template\n    };\n    try {\n      const response = await axios.post(API_URL, emailData, {\n        headers\n      });\n      if (response.status === 201) {\n        console.log(`✅ Email draft created for: ${product.title}`);\n        // Optionally do something for last_sent, e.g.:\n        // await updateLastSent(product.id);\n      } else {\n        console.error(`❌ Failed to send email for ${product.title}:`, response.data);\n      }\n    } catch (error) {\n      console.error(`⚠️ Error sending email for ${(product === null || product === void 0 ? void 0 : product.title) || \"undefined\"}:`, error);\n    }\n  }\n}\n\n// ========== 4) sendGroupEmail(selectedProducts) ==========\n//   Merges each product's fancy HTML => one big \"content\",\n//   calls Kit.com for a single broadcast\nexport async function sendGroupEmail(selectedProducts) {\n  if (!selectedProducts || selectedProducts.length === 0) {\n    console.error(\"No products selected for group email.\");\n    return;\n  }\n\n  // Subject line e.g. \"Group Deal: 3 Products Available!\"\n  const emailData = {\n    subject: `Group Deal: ${selectedProducts.length} Products Available!`,\n    // Build each product's fancy HTML & separate with <hr>\n    content: selectedProducts.map(buildEmailBody).join(\"<hr>\"),\n    public: false,\n    email_template_id: null\n  };\n  try {\n    const response = await axios.post(API_URL, emailData, {\n      headers\n    });\n    if (response.status === 201) {\n      console.log(\"✅ Group email draft created successfully.\");\n      // Optionally update last_sent for each product\n      // for (const product of selectedProducts) {\n      //   await updateLastSent(product.id);\n      // }\n    } else {\n      console.error(\"❌ Failed to send group email:\", response.data);\n    }\n  } catch (error) {\n    console.error(\"⚠️ Error sending group email:\", error);\n  }\n}\n\n// ========== Optional local last_sent helper ==========\n// If you want to track last_sent in your local DB after each \n// successful Kit broadcast, define e.g.:\n//\n// async function updateLastSent(productId) {\n//   const localServerUrl = \"http://127.0.0.1:8000/products/\"; // adjust\n//   try {\n//     await fetch(`${localServerUrl}${productId}/update-last-sent`, {\n//       method: \"POST\",\n//       headers: { \"Content-Type\": \"application/json\" },\n//       body: JSON.stringify({ last_sent: new Date().toISOString() }),\n//     });\n//   } catch (err) {\n//     console.error(\"Error updating last_sent for product:\", productId, err);\n//   }\n// }\n//\n// Then call updateLastSent(product.id) after each success above.","map":{"version":3,"names":["axios","API_URL","API_KEY","headers","Accept","buildEmailBody","product","title","trim","imageUrl","image_url","amazonUrl","amazon_url","walmartUrl","walmart_url","ebayUrl","ebay_url","price","parseFloat","toFixed","moq","qty","asin","fob","expDate","exp_date","leadTime","lead_time","includes","replace","emailBody","sendIndividualEmails","selectedProducts","length","console","error","html","emailData","subject","content","public","email_template_id","response","post","status","log","data","sendGroupEmail","map","join"],"sources":["C:/Users/josep/Documents/NPP_Deals/frontend/src/emailSender.js"],"sourcesContent":["// C:\\Users\\josep\\Documents\\NPP_Deals\\frontend\\src\\emailSender.js\r\n\r\nimport axios from \"axios\";\r\n\r\n/**\r\n * 1) Direct Kit.com broadcast endpoints\r\n *    (like your original Python -> https://api.kit.com/v4/broadcasts)\r\n */\r\nconst API_URL = \"https://api.kit.com/v4/broadcasts\";\r\nconst API_KEY = \"kit_a0a183e8fd744ca557d96126e488ae22\";\r\n\r\nconst headers = {\r\n  Accept: \"application/json\",\r\n  \"Content-Type\": \"application/json\",\r\n  \"X-Kit-Api-Key\": API_KEY,\r\n};\r\n\r\n// ========== 2) buildEmailBody(product) ==========\r\n//   Incorporates the HTML + <style> from your Python snippet\r\n//   so each product is centered, with the same background styling, \r\n//   image, and brand-colored buttons.\r\nfunction buildEmailBody(product) {\r\n  const title = (product.title || \"\").trim();\r\n  const imageUrl = product.image_url || \"\";\r\n  const amazonUrl = product.amazon_url || \"\";\r\n  const walmartUrl = product.walmart_url || \"\";\r\n  const ebayUrl = product.ebay_url || \"\";\r\n\r\n  const price = product.price ? parseFloat(product.price).toFixed(2) : \"0.00\";\r\n  const moq = product.moq || \"0\";\r\n  const qty = product.qty || \"0\";\r\n  const asin = product.asin || \"\";\r\n  const fob = product.fob || \"\";\r\n  const expDate = product.exp_date || \"\";\r\n  let leadTime = product.lead_time || \"\";\r\n\r\n  // Convert \"Days\" -> \"Business Days\"\r\n  if (leadTime.includes(\"Days\")) {\r\n    leadTime = leadTime.replace(\"Days\", \"Business Days\");\r\n  }\r\n\r\n  // EXACT inline styling from your Python approach:\r\n  // <html> ... <style> ... <body> ... so that Kit won't strip it.\r\n  const emailBody = `\r\n    <html>\r\n      <head>\r\n        <style>\r\n          body { font-family: Arial, sans-serif; text-align: center; }\r\n          .container { padding: 20px; }\r\n          .product-title { font-size: 18px; margin-bottom: 20px; }\r\n          .product-image { max-width: 300px; max-height: 300px; object-fit: contain; margin: 40px auto; display: block; }\r\n          .button { padding: 15px 25px; font-size: 16px; text-decoration: none; border-radius: 5px; margin: 5px; display: inline-block; color: white; }\r\n          .amazon { background-color: #FF9900; }\r\n          .walmart { background-color: #0071CE; }\r\n          .ebay { background-color: #E53238; }\r\n        </style>\r\n      </head>\r\n      <body>\r\n        <div class=\"container\">\r\n          <h2 class=\"product-title\">${title}</h2>\r\n          <img class=\"product-image\" src=\"${imageUrl}\" alt=\"${title}\" />\r\n\r\n          ${\r\n            amazonUrl.includes(\"https\")\r\n              ? `<a class=\"button amazon\" href=\"${amazonUrl}\">Amazon Link</a>`\r\n              : \"\"\r\n          }\r\n          ${\r\n            walmartUrl.includes(\"https\")\r\n              ? `<a class=\"button walmart\" href=\"${walmartUrl}\">Walmart Link</a>`\r\n              : \"\"\r\n          }\r\n          ${\r\n            ebayUrl.includes(\"https\")\r\n              ? `<a class=\"button ebay\" href=\"${ebayUrl}\">eBay Link</a>`\r\n              : \"\"\r\n          }\r\n\r\n          <p>$${price} EA, MOQ ${moq}, ${qty} Available.</p>\r\n          ${asin ? `<p>ASIN: ${asin}</p>` : \"\"}\r\n          ${fob ? `<p>FOB: ${fob}</p>` : \"\"}\r\n          ${expDate ? `<p>Expiration Date: ${expDate}</p>` : \"\"}\r\n          <p>Lead Time: ${leadTime}</p>\r\n        </div>\r\n      </body>\r\n    </html>\r\n  `;\r\n  return emailBody;\r\n}\r\n\r\n// ========== 3) sendIndividualEmails(selectedProducts) ==========\r\n//   Loops each product => buildEmailBody => call Kit API for each\r\n//   If you want to track last_sent, call a local server after success, \r\n//   but this snippet only hits Kit.com\r\nexport async function sendIndividualEmails(selectedProducts) {\r\n  if (!selectedProducts || selectedProducts.length === 0) {\r\n    console.error(\"No products selected for individual email.\");\r\n    return;\r\n  }\r\n\r\n  for (const product of selectedProducts) {\r\n    if (!product || !product.title) {\r\n      console.error(\"Skipping invalid product (missing title):\", product);\r\n      continue;\r\n    }\r\n\r\n    // Build the fancy HTML for this product\r\n    const html = buildEmailBody(product);\r\n\r\n    // Kit.com broadcast payload\r\n    const emailData = {\r\n      subject: product.title,\r\n      content: html,\r\n      public: false,           // Draft mode\r\n      email_template_id: null, // default template\r\n    };\r\n\r\n    try {\r\n      const response = await axios.post(API_URL, emailData, { headers });\r\n      if (response.status === 201) {\r\n        console.log(`✅ Email draft created for: ${product.title}`);\r\n        // Optionally do something for last_sent, e.g.:\r\n        // await updateLastSent(product.id);\r\n      } else {\r\n        console.error(`❌ Failed to send email for ${product.title}:`, response.data);\r\n      }\r\n    } catch (error) {\r\n      console.error(`⚠️ Error sending email for ${product?.title || \"undefined\"}:`, error);\r\n    }\r\n  }\r\n}\r\n\r\n// ========== 4) sendGroupEmail(selectedProducts) ==========\r\n//   Merges each product's fancy HTML => one big \"content\",\r\n//   calls Kit.com for a single broadcast\r\nexport async function sendGroupEmail(selectedProducts) {\r\n  if (!selectedProducts || selectedProducts.length === 0) {\r\n    console.error(\"No products selected for group email.\");\r\n    return;\r\n  }\r\n\r\n  // Subject line e.g. \"Group Deal: 3 Products Available!\"\r\n  const emailData = {\r\n    subject: `Group Deal: ${selectedProducts.length} Products Available!`,\r\n    // Build each product's fancy HTML & separate with <hr>\r\n    content: selectedProducts.map(buildEmailBody).join(\"<hr>\"),\r\n    public: false,\r\n    email_template_id: null,\r\n  };\r\n\r\n  try {\r\n    const response = await axios.post(API_URL, emailData, { headers });\r\n    if (response.status === 201) {\r\n      console.log(\"✅ Group email draft created successfully.\");\r\n      // Optionally update last_sent for each product\r\n      // for (const product of selectedProducts) {\r\n      //   await updateLastSent(product.id);\r\n      // }\r\n    } else {\r\n      console.error(\"❌ Failed to send group email:\", response.data);\r\n    }\r\n  } catch (error) {\r\n    console.error(\"⚠️ Error sending group email:\", error);\r\n  }\r\n}\r\n\r\n// ========== Optional local last_sent helper ==========\r\n// If you want to track last_sent in your local DB after each \r\n// successful Kit broadcast, define e.g.:\r\n//\r\n// async function updateLastSent(productId) {\r\n//   const localServerUrl = \"http://127.0.0.1:8000/products/\"; // adjust\r\n//   try {\r\n//     await fetch(`${localServerUrl}${productId}/update-last-sent`, {\r\n//       method: \"POST\",\r\n//       headers: { \"Content-Type\": \"application/json\" },\r\n//       body: JSON.stringify({ last_sent: new Date().toISOString() }),\r\n//     });\r\n//   } catch (err) {\r\n//     console.error(\"Error updating last_sent for product:\", productId, err);\r\n//   }\r\n// }\r\n//\r\n// Then call updateLastSent(product.id) after each success above.\r\n"],"mappings":"AAAA;;AAEA,OAAOA,KAAK,MAAM,OAAO;;AAEzB;AACA;AACA;AACA;AACA,MAAMC,OAAO,GAAG,mCAAmC;AACnD,MAAMC,OAAO,GAAG,sCAAsC;AAEtD,MAAMC,OAAO,GAAG;EACdC,MAAM,EAAE,kBAAkB;EAC1B,cAAc,EAAE,kBAAkB;EAClC,eAAe,EAAEF;AACnB,CAAC;;AAED;AACA;AACA;AACA;AACA,SAASG,cAAcA,CAACC,OAAO,EAAE;EAC/B,MAAMC,KAAK,GAAG,CAACD,OAAO,CAACC,KAAK,IAAI,EAAE,EAAEC,IAAI,CAAC,CAAC;EAC1C,MAAMC,QAAQ,GAAGH,OAAO,CAACI,SAAS,IAAI,EAAE;EACxC,MAAMC,SAAS,GAAGL,OAAO,CAACM,UAAU,IAAI,EAAE;EAC1C,MAAMC,UAAU,GAAGP,OAAO,CAACQ,WAAW,IAAI,EAAE;EAC5C,MAAMC,OAAO,GAAGT,OAAO,CAACU,QAAQ,IAAI,EAAE;EAEtC,MAAMC,KAAK,GAAGX,OAAO,CAACW,KAAK,GAAGC,UAAU,CAACZ,OAAO,CAACW,KAAK,CAAC,CAACE,OAAO,CAAC,CAAC,CAAC,GAAG,MAAM;EAC3E,MAAMC,GAAG,GAAGd,OAAO,CAACc,GAAG,IAAI,GAAG;EAC9B,MAAMC,GAAG,GAAGf,OAAO,CAACe,GAAG,IAAI,GAAG;EAC9B,MAAMC,IAAI,GAAGhB,OAAO,CAACgB,IAAI,IAAI,EAAE;EAC/B,MAAMC,GAAG,GAAGjB,OAAO,CAACiB,GAAG,IAAI,EAAE;EAC7B,MAAMC,OAAO,GAAGlB,OAAO,CAACmB,QAAQ,IAAI,EAAE;EACtC,IAAIC,QAAQ,GAAGpB,OAAO,CAACqB,SAAS,IAAI,EAAE;;EAEtC;EACA,IAAID,QAAQ,CAACE,QAAQ,CAAC,MAAM,CAAC,EAAE;IAC7BF,QAAQ,GAAGA,QAAQ,CAACG,OAAO,CAAC,MAAM,EAAE,eAAe,CAAC;EACtD;;EAEA;EACA;EACA,MAAMC,SAAS,GAAG;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sCAAsCvB,KAAK;AAC3C,4CAA4CE,QAAQ,UAAUF,KAAK;AACnE;AACA,YACYI,SAAS,CAACiB,QAAQ,CAAC,OAAO,CAAC,GACvB,kCAAkCjB,SAAS,mBAAmB,GAC9D,EAAE;AAClB,YAEYE,UAAU,CAACe,QAAQ,CAAC,OAAO,CAAC,GACxB,mCAAmCf,UAAU,oBAAoB,GACjE,EAAE;AAClB,YAEYE,OAAO,CAACa,QAAQ,CAAC,OAAO,CAAC,GACrB,gCAAgCb,OAAO,iBAAiB,GACxD,EAAE;AAClB;AACA,gBACgBE,KAAK,YAAYG,GAAG,KAAKC,GAAG;AAC5C,YAAYC,IAAI,GAAG,YAAYA,IAAI,MAAM,GAAG,EAAE;AAC9C,YAAYC,GAAG,GAAG,WAAWA,GAAG,MAAM,GAAG,EAAE;AAC3C,YAAYC,OAAO,GAAG,uBAAuBA,OAAO,MAAM,GAAG,EAAE;AAC/D,0BAA0BE,QAAQ;AAClC;AACA;AACA;AACA,GAAG;EACD,OAAOI,SAAS;AAClB;;AAEA;AACA;AACA;AACA;AACA,OAAO,eAAeC,oBAAoBA,CAACC,gBAAgB,EAAE;EAC3D,IAAI,CAACA,gBAAgB,IAAIA,gBAAgB,CAACC,MAAM,KAAK,CAAC,EAAE;IACtDC,OAAO,CAACC,KAAK,CAAC,4CAA4C,CAAC;IAC3D;EACF;EAEA,KAAK,MAAM7B,OAAO,IAAI0B,gBAAgB,EAAE;IACtC,IAAI,CAAC1B,OAAO,IAAI,CAACA,OAAO,CAACC,KAAK,EAAE;MAC9B2B,OAAO,CAACC,KAAK,CAAC,2CAA2C,EAAE7B,OAAO,CAAC;MACnE;IACF;;IAEA;IACA,MAAM8B,IAAI,GAAG/B,cAAc,CAACC,OAAO,CAAC;;IAEpC;IACA,MAAM+B,SAAS,GAAG;MAChBC,OAAO,EAAEhC,OAAO,CAACC,KAAK;MACtBgC,OAAO,EAAEH,IAAI;MACbI,MAAM,EAAE,KAAK;MAAY;MACzBC,iBAAiB,EAAE,IAAI,CAAE;IAC3B,CAAC;IAED,IAAI;MACF,MAAMC,QAAQ,GAAG,MAAM1C,KAAK,CAAC2C,IAAI,CAAC1C,OAAO,EAAEoC,SAAS,EAAE;QAAElC;MAAQ,CAAC,CAAC;MAClE,IAAIuC,QAAQ,CAACE,MAAM,KAAK,GAAG,EAAE;QAC3BV,OAAO,CAACW,GAAG,CAAC,8BAA8BvC,OAAO,CAACC,KAAK,EAAE,CAAC;QAC1D;QACA;MACF,CAAC,MAAM;QACL2B,OAAO,CAACC,KAAK,CAAC,8BAA8B7B,OAAO,CAACC,KAAK,GAAG,EAAEmC,QAAQ,CAACI,IAAI,CAAC;MAC9E;IACF,CAAC,CAAC,OAAOX,KAAK,EAAE;MACdD,OAAO,CAACC,KAAK,CAAC,8BAA8B,CAAA7B,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEC,KAAK,KAAI,WAAW,GAAG,EAAE4B,KAAK,CAAC;IACtF;EACF;AACF;;AAEA;AACA;AACA;AACA,OAAO,eAAeY,cAAcA,CAACf,gBAAgB,EAAE;EACrD,IAAI,CAACA,gBAAgB,IAAIA,gBAAgB,CAACC,MAAM,KAAK,CAAC,EAAE;IACtDC,OAAO,CAACC,KAAK,CAAC,uCAAuC,CAAC;IACtD;EACF;;EAEA;EACA,MAAME,SAAS,GAAG;IAChBC,OAAO,EAAE,eAAeN,gBAAgB,CAACC,MAAM,sBAAsB;IACrE;IACAM,OAAO,EAAEP,gBAAgB,CAACgB,GAAG,CAAC3C,cAAc,CAAC,CAAC4C,IAAI,CAAC,MAAM,CAAC;IAC1DT,MAAM,EAAE,KAAK;IACbC,iBAAiB,EAAE;EACrB,CAAC;EAED,IAAI;IACF,MAAMC,QAAQ,GAAG,MAAM1C,KAAK,CAAC2C,IAAI,CAAC1C,OAAO,EAAEoC,SAAS,EAAE;MAAElC;IAAQ,CAAC,CAAC;IAClE,IAAIuC,QAAQ,CAACE,MAAM,KAAK,GAAG,EAAE;MAC3BV,OAAO,CAACW,GAAG,CAAC,2CAA2C,CAAC;MACxD;MACA;MACA;MACA;IACF,CAAC,MAAM;MACLX,OAAO,CAACC,KAAK,CAAC,+BAA+B,EAAEO,QAAQ,CAACI,IAAI,CAAC;IAC/D;EACF,CAAC,CAAC,OAAOX,KAAK,EAAE;IACdD,OAAO,CAACC,KAAK,CAAC,+BAA+B,EAAEA,KAAK,CAAC;EACvD;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}