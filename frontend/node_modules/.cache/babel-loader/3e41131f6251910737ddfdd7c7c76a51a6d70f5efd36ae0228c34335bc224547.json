{"ast":null,"code":"// C:\\Users\\josep\\Documents\\NPP_Deals\\frontend\\src\\emailSender.js\n\nconst BASE_URL = \"http://127.0.0.1:8000\"; // Adjust if your FastAPI runs elsewhere\n\n// ========== 1) Helper: Build your nice HTML for each product ==========\n// (If you still want to send HTML in single emails.)\nexport function buildEmailBody(product) {\n  const title = (product.title || \"\").trim();\n  const imageUrl = product.image_url || \"\";\n  const amazonUrl = product.amazon_url || \"\";\n  const walmartUrl = product.walmart_url || \"\";\n  const ebayUrl = product.ebay_url || \"\";\n  const price = product.price ? parseFloat(product.price).toFixed(2) : \"0.00\";\n  const moq = product.moq || \"0\";\n  const qty = product.qty || \"0\";\n  const asin = product.asin || \"\";\n  const fob = product.fob || \"\";\n  const expDate = product.exp_date || \"\";\n  let leadTime = product.lead_time || \"\";\n\n  // Fix \"Days\" => \"Business Days\"\n  if (leadTime.includes(\"Days\")) {\n    leadTime = leadTime.replace(\"Days\", \"Business Days\");\n  }\n  let emailBody = `\n    <div style=\"text-align:center; font-family:Arial, sans-serif; padding:20px; color:#333;\">\n      <h2 style=\"font-size:22px; margin-bottom:15px; color:#444;\">${title}</h2>\n      <div style=\"display:flex; justify-content:center; margin-bottom:20px;\">\n        <img src=\"${imageUrl}\" alt=\"${title}\"\n             style=\"max-width:300px; max-height:300px; width:auto; height:auto; object-fit:contain;\" />\n      </div>\n      <div style=\"margin-bottom:15px;\">\n        <p style=\"font-size:18px; color:#555;\">Price: <strong>$${price}</strong> EA</p>\n        <p style=\"font-size:18px; color:#555;\">MOQ: <strong>${moq}</strong> | Available: <strong>${qty}</strong></p>\n  `;\n  if (asin) {\n    emailBody += `<p style=\"font-size:18px; color:#555;\">ASIN: <strong>${asin}</strong></p>`;\n  }\n  if (fob) {\n    emailBody += `<p style=\"font-size:18px; color:#555;\">FOB: <strong>${fob}</strong></p>`;\n  }\n  if (expDate) {\n    emailBody += `<p style=\"font-size:18px; color:#555;\">Expiration Date: <strong>${expDate}</strong></p>`;\n  }\n  emailBody += `\n        <p style=\"font-size:18px; color:#555;\">Lead Time: <strong>${leadTime}</strong></p>\n      </div>\n      <div style=\"margin-top:20px; margin-bottom:30px;\">\n  `;\n  if (amazonUrl.includes(\"https\")) {\n    emailBody += `\n        <a href=\"${amazonUrl}\"\n           style=\"background-color:#FF9900; color:white; padding:12px 20px; text-align:center;\n                  text-decoration:none; display:block; font-size:16px; margin:10px auto; width: fit-content; border-radius:5px;\">\n          üîó Amazon Link\n        </a>\n    `;\n  }\n  if (walmartUrl.includes(\"https\")) {\n    emailBody += `\n        <a href=\"${walmartUrl}\"\n           style=\"background-color:#0071CE; color:white; padding:12px 20px; text-align:center;\n                  text-decoration:none; display:block; font-size:16px; margin:10px auto; width: fit-content; border-radius:5px;\">\n          üîó Walmart Link\n        </a>\n    `;\n  }\n  if (ebayUrl.includes(\"https\")) {\n    emailBody += `\n        <a href=\"${ebayUrl}\"\n           style=\"background-color:#E53238; color:white; padding:12px 20px; text-align:center;\n                  text-decoration:none; display:block; font-size:16px; margin:10px auto; width: fit-content; border-radius:5px;\">\n          üîó eBay Link\n        </a>\n    `;\n  }\n  emailBody += `</div></div>`;\n  return emailBody;\n}\n\n// ========== 2) Single (Individual) Emails ==========\n// Loops over each product => call POST /products/{id}/send-email\nexport async function sendIndividualEmails(selectedProducts) {\n  if (!Array.isArray(selectedProducts) || selectedProducts.length === 0) {\n    console.error(\"No products selected for individual email.\");\n    return;\n  }\n  for (const product of selectedProducts) {\n    if (!product || !product.id) {\n      console.warn(\"Skipping invalid product with no ID:\", product);\n      continue;\n    }\n    const productId = product.id;\n    const html = buildEmailBody(product);\n    console.log(`üîπ Sending INDIVIDUAL email for Product ID ${productId}`);\n    try {\n      const response = await fetch(`${BASE_URL}/products/${productId}/send-email/`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          content: html\n        }) // The server can forward \"content\" to Kit\n      });\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error(`‚ùå Failed to send email for Product ${productId}: ${response.status} - ${errorText}`);\n      } else {\n        const data = await response.json();\n        console.log(`‚úÖ Success for Product ${productId}. last_sent => ${data.last_sent}`);\n      }\n    } catch (err) {\n      console.error(`‚ö†Ô∏è Error sending email for Product ${productId}:`, err);\n    }\n  }\n  console.log(\"‚úÖ Finished sending individual emails for all selected products.\");\n}\n\n// ========== 3) Group Email ==========\n// Calls POST /products/send-group-email once with just the IDs\nexport async function sendGroupEmail(selectedProducts) {\n  if (!Array.isArray(selectedProducts) || selectedProducts.length === 0) {\n    console.error(\"No products selected for group email.\");\n    return;\n  }\n\n  // The server route typically expects { product_ids: [...] }\n  const productIds = selectedProducts.map(p => p.id);\n  console.log(`üîπ Sending GROUP email for product IDs: ${productIds.join(\", \")}`);\n  try {\n    const response = await fetch(`${BASE_URL}/products/send-group-email/`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        product_ids: productIds\n      })\n    });\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`HTTP ${response.status} - ${errorText}`);\n    }\n    const data = await response.json();\n    console.log(`‚úÖ Group email success. last_sent => ${data.last_sent}`);\n  } catch (error) {\n    console.error(\"‚ùå Error sending group email:\", error);\n  }\n}","map":{"version":3,"names":["BASE_URL","buildEmailBody","product","title","trim","imageUrl","image_url","amazonUrl","amazon_url","walmartUrl","walmart_url","ebayUrl","ebay_url","price","parseFloat","toFixed","moq","qty","asin","fob","expDate","exp_date","leadTime","lead_time","includes","replace","emailBody","sendIndividualEmails","selectedProducts","Array","isArray","length","console","error","id","warn","productId","html","log","response","fetch","method","headers","body","JSON","stringify","content","ok","errorText","text","status","data","json","last_sent","err","sendGroupEmail","productIds","map","p","join","product_ids","Error"],"sources":["C:/Users/josep/Documents/NPP_Deals/frontend/src/emailSender.js"],"sourcesContent":["// C:\\Users\\josep\\Documents\\NPP_Deals\\frontend\\src\\emailSender.js\r\n\r\nconst BASE_URL = \"http://127.0.0.1:8000\"; // Adjust if your FastAPI runs elsewhere\r\n\r\n// ========== 1) Helper: Build your nice HTML for each product ==========\r\n// (If you still want to send HTML in single emails.)\r\nexport function buildEmailBody(product) {\r\n  const title = (product.title || \"\").trim();\r\n  const imageUrl = product.image_url || \"\";\r\n  const amazonUrl = product.amazon_url || \"\";\r\n  const walmartUrl = product.walmart_url || \"\";\r\n  const ebayUrl = product.ebay_url || \"\";\r\n  const price = product.price ? parseFloat(product.price).toFixed(2) : \"0.00\";\r\n  const moq = product.moq || \"0\";\r\n  const qty = product.qty || \"0\";\r\n  const asin = product.asin || \"\";\r\n  const fob = product.fob || \"\";\r\n  const expDate = product.exp_date || \"\";\r\n  let leadTime = product.lead_time || \"\";\r\n\r\n  // Fix \"Days\" => \"Business Days\"\r\n  if (leadTime.includes(\"Days\")) {\r\n    leadTime = leadTime.replace(\"Days\", \"Business Days\");\r\n  }\r\n\r\n  let emailBody = `\r\n    <div style=\"text-align:center; font-family:Arial, sans-serif; padding:20px; color:#333;\">\r\n      <h2 style=\"font-size:22px; margin-bottom:15px; color:#444;\">${title}</h2>\r\n      <div style=\"display:flex; justify-content:center; margin-bottom:20px;\">\r\n        <img src=\"${imageUrl}\" alt=\"${title}\"\r\n             style=\"max-width:300px; max-height:300px; width:auto; height:auto; object-fit:contain;\" />\r\n      </div>\r\n      <div style=\"margin-bottom:15px;\">\r\n        <p style=\"font-size:18px; color:#555;\">Price: <strong>$${price}</strong> EA</p>\r\n        <p style=\"font-size:18px; color:#555;\">MOQ: <strong>${moq}</strong> | Available: <strong>${qty}</strong></p>\r\n  `;\r\n\r\n  if (asin) {\r\n    emailBody += `<p style=\"font-size:18px; color:#555;\">ASIN: <strong>${asin}</strong></p>`;\r\n  }\r\n  if (fob) {\r\n    emailBody += `<p style=\"font-size:18px; color:#555;\">FOB: <strong>${fob}</strong></p>`;\r\n  }\r\n  if (expDate) {\r\n    emailBody += `<p style=\"font-size:18px; color:#555;\">Expiration Date: <strong>${expDate}</strong></p>`;\r\n  }\r\n\r\n  emailBody += `\r\n        <p style=\"font-size:18px; color:#555;\">Lead Time: <strong>${leadTime}</strong></p>\r\n      </div>\r\n      <div style=\"margin-top:20px; margin-bottom:30px;\">\r\n  `;\r\n\r\n  if (amazonUrl.includes(\"https\")) {\r\n    emailBody += `\r\n        <a href=\"${amazonUrl}\"\r\n           style=\"background-color:#FF9900; color:white; padding:12px 20px; text-align:center;\r\n                  text-decoration:none; display:block; font-size:16px; margin:10px auto; width: fit-content; border-radius:5px;\">\r\n          üîó Amazon Link\r\n        </a>\r\n    `;\r\n  }\r\n  if (walmartUrl.includes(\"https\")) {\r\n    emailBody += `\r\n        <a href=\"${walmartUrl}\"\r\n           style=\"background-color:#0071CE; color:white; padding:12px 20px; text-align:center;\r\n                  text-decoration:none; display:block; font-size:16px; margin:10px auto; width: fit-content; border-radius:5px;\">\r\n          üîó Walmart Link\r\n        </a>\r\n    `;\r\n  }\r\n  if (ebayUrl.includes(\"https\")) {\r\n    emailBody += `\r\n        <a href=\"${ebayUrl}\"\r\n           style=\"background-color:#E53238; color:white; padding:12px 20px; text-align:center;\r\n                  text-decoration:none; display:block; font-size:16px; margin:10px auto; width: fit-content; border-radius:5px;\">\r\n          üîó eBay Link\r\n        </a>\r\n    `;\r\n  }\r\n\r\n  emailBody += `</div></div>`;\r\n\r\n  return emailBody;\r\n}\r\n\r\n// ========== 2) Single (Individual) Emails ==========\r\n// Loops over each product => call POST /products/{id}/send-email\r\nexport async function sendIndividualEmails(selectedProducts) {\r\n  if (!Array.isArray(selectedProducts) || selectedProducts.length === 0) {\r\n    console.error(\"No products selected for individual email.\");\r\n    return;\r\n  }\r\n\r\n  for (const product of selectedProducts) {\r\n    if (!product || !product.id) {\r\n      console.warn(\"Skipping invalid product with no ID:\", product);\r\n      continue;\r\n    }\r\n    const productId = product.id;\r\n    const html = buildEmailBody(product);\r\n\r\n    console.log(`üîπ Sending INDIVIDUAL email for Product ID ${productId}`);\r\n\r\n    try {\r\n      const response = await fetch(`${BASE_URL}/products/${productId}/send-email/`, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ content: html }), // The server can forward \"content\" to Kit\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorText = await response.text();\r\n        console.error(\r\n          `‚ùå Failed to send email for Product ${productId}: ${response.status} - ${errorText}`\r\n        );\r\n      } else {\r\n        const data = await response.json();\r\n        console.log(`‚úÖ Success for Product ${productId}. last_sent => ${data.last_sent}`);\r\n      }\r\n    } catch (err) {\r\n      console.error(`‚ö†Ô∏è Error sending email for Product ${productId}:`, err);\r\n    }\r\n  }\r\n\r\n  console.log(\"‚úÖ Finished sending individual emails for all selected products.\");\r\n}\r\n\r\n// ========== 3) Group Email ==========\r\n// Calls POST /products/send-group-email once with just the IDs\r\nexport async function sendGroupEmail(selectedProducts) {\r\n  if (!Array.isArray(selectedProducts) || selectedProducts.length === 0) {\r\n    console.error(\"No products selected for group email.\");\r\n    return;\r\n  }\r\n\r\n  // The server route typically expects { product_ids: [...] }\r\n  const productIds = selectedProducts.map((p) => p.id);\r\n\r\n  console.log(`üîπ Sending GROUP email for product IDs: ${productIds.join(\", \")}`);\r\n\r\n  try {\r\n    const response = await fetch(`${BASE_URL}/products/send-group-email/`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ product_ids: productIds }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text();\r\n      throw new Error(`HTTP ${response.status} - ${errorText}`);\r\n    }\r\n    const data = await response.json();\r\n    console.log(`‚úÖ Group email success. last_sent => ${data.last_sent}`);\r\n  } catch (error) {\r\n    console.error(\"‚ùå Error sending group email:\", error);\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}