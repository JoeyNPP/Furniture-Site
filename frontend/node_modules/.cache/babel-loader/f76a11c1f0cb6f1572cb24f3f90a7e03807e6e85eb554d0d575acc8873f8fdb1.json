{"ast":null,"code":"import axios from \"axios\";\nimport { updateProduct } from \"./api\"; // ‚úÖ Ensures last_sent tracking works\n\nconst API_URL = \"https://api.kit.com/v4/broadcasts\";\nconst API_KEY = \"kit_a0a183e8fd744ca557d96126e488ae22\";\nconst headers = {\n  Accept: \"application/json\",\n  \"Content-Type\": \"application/json\",\n  \"X-Kit-Api-Key\": API_KEY\n};\n\n/**\r\n * ‚úÖ Send Individual Emails & Ensure last_sent is updated correctly\r\n */\nexport async function sendIndividualEmails(selectedProducts) {\n  if (!selectedProducts || selectedProducts.length === 0) {\n    console.error(\"No products selected for individual email.\");\n    return;\n  }\n  for (const product of selectedProducts) {\n    if (!(product !== null && product !== void 0 && product.id)) {\n      console.error(\"Skipping product with no ID:\", product);\n      continue;\n    }\n    const localUrl = `http://127.0.0.1:8000/products/${product.id}/send-email/`;\n    console.log(`üîπ Sending individual email via FastAPI: POST ${localUrl}`);\n    try {\n      const emailData = {\n        subject: product.title,\n        content: buildPythonStyleEmail(product),\n        // ‚úÖ Ensures proper formatting\n        public: false,\n        email_template_id: None // ‚úÖ Matches Python implementation\n      };\n      console.log(\"\\nüîç DEBUG: Payload being sent to Kit API:\");\n      console.log(JSON.stringify(emailData, null, 2)); // ‚úÖ Pretty-print JSON\n\n      const response = await fetch(localUrl, {\n        method: \"POST\",\n        headers: new Headers({\n          \"Accept\": \"application/json\",\n          \"Content-Type\": \"application/json\",\n          \"X-Kit-Api-Key\": API_KEY\n        }),\n        body: JSON.stringify(emailData)\n      });\n      if (!response.ok) {\n        const errText = await response.text();\n        console.error(`‚ùå Failed to send single email for ID ${product.id}:`, errText);\n      } else {\n        const data = await response.json();\n        console.log(`‚úÖ Email & last_sent updated for ID ${product.id}:`, data);\n      }\n    } catch (error) {\n      console.error(\"‚ùå Network error sending single email:\", error);\n    }\n  }\n}\n\n/**\r\n * ‚úÖ Send Group Email & Ensure last_sent is updated correctly\r\n */\nexport async function sendGroupEmail(selectedProducts) {\n  if (!selectedProducts || selectedProducts.length === 0) {\n    console.error(\"No products selected for group email.\");\n    return;\n  }\n  const productIds = selectedProducts.map(p => p.id).filter(Boolean);\n  if (!productIds.length) {\n    console.error(\"Skipping group email, invalid product IDs.\");\n    return;\n  }\n  const localUrl = \"http://127.0.0.1:8000/products/send-group-email/\";\n  console.log(`üîπ Sending group email via FastAPI: POST ${localUrl}`, productIds);\n  const emailData = {\n    subject: `Group Deal: ${selectedProducts.length} Products Available!`,\n    content: selectedProducts.map(buildPythonStyleEmail).join(\"<hr>\"),\n    // ‚úÖ Ensures full HTML formatting\n    public: false,\n    email_template_id: None // ‚úÖ Matches Python implementation\n  };\n  try {\n    console.log(\"\\nüîç DEBUG: Payload being sent to Kit API:\");\n    console.log(JSON.stringify(emailData, null, 2)); // Pretty-print JSON\n\n    const response = await fetch(localUrl, {\n      method: \"POST\",\n      headers: {\n        \"Accept\": \"application/json\",\n        \"Content-Type\": \"application/json\",\n        \"X-Kit-Api-Key\": API_KEY\n      },\n      body: JSON.stringify(emailData)\n    });\n    if (!response.ok) {\n      const errText = await response.text();\n      console.error(\"‚ùå Failed to send group email:\", errText);\n    } else {\n      const data = await response.json();\n      console.log(`‚úÖ Group email & last_sent updated for IDs ${productIds}:`, data);\n    }\n  } catch (error) {\n    console.error(\"‚ùå Network error sending group email:\", error);\n  }\n}","map":{"version":3,"names":["axios","updateProduct","API_URL","API_KEY","headers","Accept","sendIndividualEmails","selectedProducts","length","console","error","product","id","localUrl","log","emailData","subject","title","content","buildPythonStyleEmail","public","email_template_id","None","JSON","stringify","response","fetch","method","Headers","body","ok","errText","text","data","json","sendGroupEmail","productIds","map","p","filter","Boolean","join"],"sources":["C:/Users/josep/Documents/NPP_Deals/frontend/src/emailSender.js"],"sourcesContent":["import axios from \"axios\";\r\nimport { updateProduct } from \"./api\"; // ‚úÖ Ensures last_sent tracking works\r\n\r\nconst API_URL = \"https://api.kit.com/v4/broadcasts\";\r\nconst API_KEY = \"kit_a0a183e8fd744ca557d96126e488ae22\";\r\n\r\nconst headers = {\r\n  Accept: \"application/json\",\r\n  \"Content-Type\": \"application/json\",\r\n  \"X-Kit-Api-Key\": API_KEY,\r\n};\r\n\r\n/**\r\n * ‚úÖ Send Individual Emails & Ensure last_sent is updated correctly\r\n */\r\nexport async function sendIndividualEmails(selectedProducts) {\r\n  if (!selectedProducts || selectedProducts.length === 0) {\r\n    console.error(\"No products selected for individual email.\");\r\n    return;\r\n  }\r\n\r\n  for (const product of selectedProducts) {\r\n    if (!product?.id) {\r\n      console.error(\"Skipping product with no ID:\", product);\r\n      continue;\r\n    }\r\n\r\n    const localUrl = `http://127.0.0.1:8000/products/${product.id}/send-email/`;\r\n    console.log(`üîπ Sending individual email via FastAPI: POST ${localUrl}`);\r\n\r\n    try {\r\n      const emailData = {\r\n        subject: product.title,\r\n        content: buildPythonStyleEmail(product),  // ‚úÖ Ensures proper formatting\r\n        public: false,\r\n        email_template_id: None  // ‚úÖ Matches Python implementation\r\n      };      \r\n      \r\n      console.log(\"\\nüîç DEBUG: Payload being sent to Kit API:\");\r\n      console.log(JSON.stringify(emailData, null, 2)); // ‚úÖ Pretty-print JSON\r\n      \r\n      const response = await fetch(localUrl, {\r\n        method: \"POST\",\r\n        headers: new Headers({\r\n          \"Accept\": \"application/json\",\r\n          \"Content-Type\": \"application/json\",\r\n          \"X-Kit-Api-Key\": API_KEY\r\n        }),\r\n        body: JSON.stringify(emailData),\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        const errText = await response.text();\r\n        console.error(`‚ùå Failed to send single email for ID ${product.id}:`, errText);\r\n      } else {\r\n        const data = await response.json();\r\n        console.log(`‚úÖ Email & last_sent updated for ID ${product.id}:`, data);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"‚ùå Network error sending single email:\", error);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * ‚úÖ Send Group Email & Ensure last_sent is updated correctly\r\n */\r\nexport async function sendGroupEmail(selectedProducts) {\r\n  if (!selectedProducts || selectedProducts.length === 0) {\r\n    console.error(\"No products selected for group email.\");\r\n    return;\r\n  }\r\n\r\n  const productIds = selectedProducts.map((p) => p.id).filter(Boolean);\r\n  if (!productIds.length) {\r\n    console.error(\"Skipping group email, invalid product IDs.\");\r\n    return;\r\n  }\r\n\r\n  const localUrl = \"http://127.0.0.1:8000/products/send-group-email/\";\r\n  console.log(`üîπ Sending group email via FastAPI: POST ${localUrl}`, productIds);\r\n\r\n  const emailData = {\r\n    subject: `Group Deal: ${selectedProducts.length} Products Available!`,\r\n    content: selectedProducts.map(buildPythonStyleEmail).join(\"<hr>\"), // ‚úÖ Ensures full HTML formatting\r\n    public: false,\r\n    email_template_id: None  // ‚úÖ Matches Python implementation\r\n  };\r\n\r\n  try {\r\n    console.log(\"\\nüîç DEBUG: Payload being sent to Kit API:\");\r\n    console.log(JSON.stringify(emailData, null, 2)); // Pretty-print JSON\r\n\r\n    const response = await fetch(localUrl, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Accept\": \"application/json\",\r\n        \"Content-Type\": \"application/json\",\r\n        \"X-Kit-Api-Key\": API_KEY\r\n      },\r\n      body: JSON.stringify(emailData),\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      const errText = await response.text();\r\n      console.error(\"‚ùå Failed to send group email:\", errText);\r\n    } else {\r\n      const data = await response.json();\r\n      console.log(`‚úÖ Group email & last_sent updated for IDs ${productIds}:`, data);\r\n    }\r\n  } catch (error) {\r\n    console.error(\"‚ùå Network error sending group email:\", error);\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}