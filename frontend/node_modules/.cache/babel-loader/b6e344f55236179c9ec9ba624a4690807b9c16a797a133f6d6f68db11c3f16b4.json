{"ast":null,"code":"import axios from \"axios\";\nimport { updateProduct } from \"./api\"; // ‚úÖ Ensures last_sent tracking works\n\nconst API_URL = \"https://api.kit.com/v4/broadcasts\";\nconst API_KEY = \"kit_a0a183e8fd744ca557d96126e488ae22\";\nconst headers = {\n  Accept: \"application/json\",\n  \"Content-Type\": \"application/json\",\n  \"X-Kit-Api-Key\": API_KEY\n};\n\n/**\r\n * ‚úÖ Send Individual Emails & Ensure last_sent is updated correctly\r\n */\nexport async function sendIndividualEmails(selectedProducts) {\n  if (!selectedProducts || selectedProducts.length === 0) {\n    console.error(\"No products selected for individual email.\");\n    return;\n  }\n  for (const product of selectedProducts) {\n    if (!(product !== null && product !== void 0 && product.id)) {\n      console.error(\"Skipping product with no ID:\", product);\n      continue;\n    }\n\n    // Instead of calling Kit API, call the FastAPI backend\n    const localUrl = `http://127.0.0.1:8000/products/${product.id}/send-email/`;\n    console.log(`üîπ Sending individual email via FastAPI: POST ${localUrl}`);\n    try {\n      const response = await fetch(localUrl, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        }\n      });\n      if (!response.ok) {\n        const errText = await response.text();\n        console.error(`‚ùå Failed to send single email for ID ${product.id}:`, errText);\n      } else {\n        const data = await response.json();\n        console.log(`‚úÖ Email & last_sent updated for ID ${product.id}:`, data);\n      }\n    } catch (error) {\n      console.error(\"‚ùå Network error sending single email:\", error);\n    }\n  }\n}\n\n/**\r\n * ‚úÖ Send Group Email & Ensure last_sent is updated correctly\r\n */\nexport async function sendGroupEmail(selectedProducts) {\n  if (!selectedProducts || selectedProducts.length === 0) {\n    console.error(\"No products selected for group email.\");\n    return;\n  }\n\n  // Grab array of IDs for your group route\n  const productIds = selectedProducts.map(p => p.id).filter(Boolean);\n  if (!productIds.length) {\n    console.error(\"Skipping group email, invalid product IDs.\");\n    return;\n  }\n  const localUrl = \"http://127.0.0.1:8000/products/send-group-email/\";\n  console.log(`üîπ Sending group email via FastAPI: POST ${localUrl}`, productIds);\n  try {\n    const response = await fetch(localUrl, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(productIds)\n    });\n    if (!response.ok) {\n      const errText = await response.text();\n      console.error(\"‚ùå Failed to send group email:\", errText);\n    } else {\n      const data = await response.json();\n      console.log(`‚úÖ Group email & last_sent updated for IDs ${productIds}:`, data);\n    }\n  } catch (error) {\n    console.error(\"‚ùå Network error sending group email:\", error);\n  }\n}\n\n/**\r\n * ‚úÖ Build the Email EXACTLY Like Python Code\r\n */\nfunction buildPythonStyleEmail({\n  subject,\n  amazonUrl,\n  walmartUrl,\n  ebayUrl,\n  imageUrl,\n  price,\n  moq,\n  qty,\n  asin,\n  fob,\n  expDate,\n  leadTime\n}) {\n  return `\n    <div style=\"padding: 20px 0; text-align: center; font-family: Arial, sans-serif;\">\n      \n      <!-- Product Title -->\n      <h2 style=\"font-size:18px; margin-bottom: 20px; text-align: center;\">${subject}</h2>\n\n      <!-- Product Image -->\n      <img src=\"${imageUrl}\" alt=\"${subject}\" \n           style=\"max-width:300px; max-height:300px; width:auto; height:auto; object-fit:contain; \n                  display:block; margin-left:auto; margin-right:auto; margin-top:40px; margin-bottom:40px;\" />\n\n      <!-- Buttons Section -->\n      <div style=\"margin-top:20px; margin-bottom:20px; text-align: center;\">\n        ${amazonUrl.includes(\"https\") ? `<a href=\"${amazonUrl}\" \n                style=\"background-color:#FF9900; color:white; padding:15px 25px; text-align:center;\n                      text-decoration:none; display:inline-block; font-size:16px; margin:10px auto; border-radius:5px;\">\n                Amazon Link\n            </a>` : \"\"}\n        ${walmartUrl.includes(\"https\") ? `<a href=\"${walmartUrl}\" \n                style=\"background-color:#0071CE; color:white; padding:15px 25px; text-align:center;\n                      text-decoration:none; display:inline-block; font-size:16px; margin:10px auto; border-radius:5px;\">\n                Walmart Link\n            </a>` : \"\"}\n        ${ebayUrl.includes(\"https\") ? `<a href=\"${ebayUrl}\" \n                style=\"background-color:#E53238; color:white; padding:15px 25px; text-align:center;\n                      text-decoration:none; display:inline-block; font-size:16px; margin:10px auto; border-radius:5px;\">\n                eBay Link\n            </a>` : \"\"}\n      </div>\n\n      <!-- Product Details -->\n      <div style=\"text-align: center; margin-bottom: 20px;\">\n        <p style=\"font-size:18px; margin:10px auto; text-align: center;\">\n          <strong>Price: $${price} EA</strong>\n        </p>\n        <p style=\"font-size:18px; margin:10px auto; text-align: center;\">\n          MOQ: <strong>${moq}</strong> | Available: <strong>${qty}</strong>\n        </p>\n        ${asin ? `<p style=\"font-size:18px; margin:10px auto; text-align: center;\">ASIN: <strong>${asin}</strong></p>` : \"\"}\n        ${fob ? `<p style=\"font-size:18px; margin:10px auto; text-align: center;\">FOB: <strong>${fob}</strong></p>` : \"\"}\n        ${expDate ? `<p style=\"font-size:18px; margin:10px auto; text-align: center;\">Expiration Date: <strong>${expDate}</strong></p>` : \"\"}\n\n        <p style=\"font-size:18px; margin:10px auto; text-align: center;\">Lead Time: <strong>${leadTime}</strong></p>\n      </div>\n\n    </div>\n  `;\n}","map":{"version":3,"names":["axios","updateProduct","API_URL","API_KEY","headers","Accept","sendIndividualEmails","selectedProducts","length","console","error","product","id","localUrl","log","response","fetch","method","ok","errText","text","data","json","sendGroupEmail","productIds","map","p","filter","Boolean","body","JSON","stringify","buildPythonStyleEmail","subject","amazonUrl","walmartUrl","ebayUrl","imageUrl","price","moq","qty","asin","fob","expDate","leadTime","includes"],"sources":["C:/Users/josep/Documents/NPP_Deals/frontend/src/emailSender.js"],"sourcesContent":["import axios from \"axios\";\r\nimport { updateProduct } from \"./api\"; // ‚úÖ Ensures last_sent tracking works\r\n\r\nconst API_URL = \"https://api.kit.com/v4/broadcasts\";\r\nconst API_KEY = \"kit_a0a183e8fd744ca557d96126e488ae22\";\r\n\r\nconst headers = {\r\n  Accept: \"application/json\",\r\n  \"Content-Type\": \"application/json\",\r\n  \"X-Kit-Api-Key\": API_KEY,\r\n};\r\n\r\n/**\r\n * ‚úÖ Send Individual Emails & Ensure last_sent is updated correctly\r\n */\r\nexport async function sendIndividualEmails(selectedProducts) {\r\n  if (!selectedProducts || selectedProducts.length === 0) {\r\n    console.error(\"No products selected for individual email.\");\r\n    return;\r\n  }\r\n\r\n  for (const product of selectedProducts) {\r\n    if (!product?.id) {\r\n      console.error(\"Skipping product with no ID:\", product);\r\n      continue;\r\n    }\r\n\r\n    // Instead of calling Kit API, call the FastAPI backend\r\n    const localUrl = `http://127.0.0.1:8000/products/${product.id}/send-email/`;\r\n    console.log(`üîπ Sending individual email via FastAPI: POST ${localUrl}`);\r\n\r\n    try {\r\n      const response = await fetch(localUrl, {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      });\r\n      if (!response.ok) {\r\n        const errText = await response.text();\r\n        console.error(`‚ùå Failed to send single email for ID ${product.id}:`, errText);\r\n      } else {\r\n        const data = await response.json();\r\n        console.log(`‚úÖ Email & last_sent updated for ID ${product.id}:`, data);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"‚ùå Network error sending single email:\", error);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * ‚úÖ Send Group Email & Ensure last_sent is updated correctly\r\n */\r\nexport async function sendGroupEmail(selectedProducts) {\r\n  if (!selectedProducts || selectedProducts.length === 0) {\r\n    console.error(\"No products selected for group email.\");\r\n    return;\r\n  }\r\n\r\n  // Grab array of IDs for your group route\r\n  const productIds = selectedProducts.map((p) => p.id).filter(Boolean);\r\n  if (!productIds.length) {\r\n    console.error(\"Skipping group email, invalid product IDs.\");\r\n    return;\r\n  }\r\n\r\n  const localUrl = \"http://127.0.0.1:8000/products/send-group-email/\";\r\n  console.log(`üîπ Sending group email via FastAPI: POST ${localUrl}`, productIds);\r\n\r\n  try {\r\n    const response = await fetch(localUrl, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify(productIds),\r\n    });\r\n    if (!response.ok) {\r\n      const errText = await response.text();\r\n      console.error(\"‚ùå Failed to send group email:\", errText);\r\n    } else {\r\n      const data = await response.json();\r\n      console.log(`‚úÖ Group email & last_sent updated for IDs ${productIds}:`, data);\r\n    }\r\n  } catch (error) {\r\n    console.error(\"‚ùå Network error sending group email:\", error);\r\n  }\r\n}\r\n\r\n/**\r\n * ‚úÖ Build the Email EXACTLY Like Python Code\r\n */\r\nfunction buildPythonStyleEmail({\r\n  subject,\r\n  amazonUrl,\r\n  walmartUrl,\r\n  ebayUrl,\r\n  imageUrl,\r\n  price,\r\n  moq,\r\n  qty,\r\n  asin,\r\n  fob,\r\n  expDate,\r\n  leadTime,\r\n}) {\r\n  return `\r\n    <div style=\"padding: 20px 0; text-align: center; font-family: Arial, sans-serif;\">\r\n      \r\n      <!-- Product Title -->\r\n      <h2 style=\"font-size:18px; margin-bottom: 20px; text-align: center;\">${subject}</h2>\r\n\r\n      <!-- Product Image -->\r\n      <img src=\"${imageUrl}\" alt=\"${subject}\" \r\n           style=\"max-width:300px; max-height:300px; width:auto; height:auto; object-fit:contain; \r\n                  display:block; margin-left:auto; margin-right:auto; margin-top:40px; margin-bottom:40px;\" />\r\n\r\n      <!-- Buttons Section -->\r\n      <div style=\"margin-top:20px; margin-bottom:20px; text-align: center;\">\r\n        ${amazonUrl.includes(\"https\") \r\n          ? `<a href=\"${amazonUrl}\" \r\n                style=\"background-color:#FF9900; color:white; padding:15px 25px; text-align:center;\r\n                      text-decoration:none; display:inline-block; font-size:16px; margin:10px auto; border-radius:5px;\">\r\n                Amazon Link\r\n            </a>` \r\n          : \"\"}\r\n        ${walmartUrl.includes(\"https\") \r\n          ? `<a href=\"${walmartUrl}\" \r\n                style=\"background-color:#0071CE; color:white; padding:15px 25px; text-align:center;\r\n                      text-decoration:none; display:inline-block; font-size:16px; margin:10px auto; border-radius:5px;\">\r\n                Walmart Link\r\n            </a>` \r\n          : \"\"}\r\n        ${ebayUrl.includes(\"https\") \r\n          ? `<a href=\"${ebayUrl}\" \r\n                style=\"background-color:#E53238; color:white; padding:15px 25px; text-align:center;\r\n                      text-decoration:none; display:inline-block; font-size:16px; margin:10px auto; border-radius:5px;\">\r\n                eBay Link\r\n            </a>` \r\n          : \"\"}\r\n      </div>\r\n\r\n      <!-- Product Details -->\r\n      <div style=\"text-align: center; margin-bottom: 20px;\">\r\n        <p style=\"font-size:18px; margin:10px auto; text-align: center;\">\r\n          <strong>Price: $${price} EA</strong>\r\n        </p>\r\n        <p style=\"font-size:18px; margin:10px auto; text-align: center;\">\r\n          MOQ: <strong>${moq}</strong> | Available: <strong>${qty}</strong>\r\n        </p>\r\n        ${asin ? `<p style=\"font-size:18px; margin:10px auto; text-align: center;\">ASIN: <strong>${asin}</strong></p>` : \"\"}\r\n        ${fob ? `<p style=\"font-size:18px; margin:10px auto; text-align: center;\">FOB: <strong>${fob}</strong></p>` : \"\"}\r\n        ${expDate ? `<p style=\"font-size:18px; margin:10px auto; text-align: center;\">Expiration Date: <strong>${expDate}</strong></p>` : \"\"}\r\n\r\n        <p style=\"font-size:18px; margin:10px auto; text-align: center;\">Lead Time: <strong>${leadTime}</strong></p>\r\n      </div>\r\n\r\n    </div>\r\n  `;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}