{"ast":null,"code":"import axios from \"axios\";\nimport { updateProduct } from \"./api\"; // ‚úÖ Ensures last_sent tracking works\n\nconst API_URL = \"https://api.kit.com/v4/broadcasts\";\nconst API_KEY = \"kit_a0a183e8fd744ca557d96126e488ae22\";\nconst headers = {\n  Accept: \"application/json\",\n  \"Content-Type\": \"application/json\",\n  \"X-Kit-Api-Key\": API_KEY\n};\n\n/**\r\n * ‚úÖ Build the HTML Email EXACTLY Like Python Code\r\n */\nfunction buildPythonStyleEmail(product) {\n  return `\n    <div style='padding: 20px 0;'>\n        <div style=\"text-align:center; margin-bottom: 60px;\">\n            <h2 style=\"font-size:18px; margin-bottom: 20px;\">${product.title}</h2>\n            <img src=\"${product.image_url}\" alt=\"${product.title}\"\n                 style=\"max-width:300px; max-height:300px; width:auto; height:auto; object-fit:contain;\n                        display:block; margin-left:auto; margin-right:auto; margin-top:40px; margin-bottom:40px;\"/>\n            \n            ${product.amazon_url ? `<a href=\"${product.amazon_url}\"\n               style=\"background-color:#FF9900; color:white; padding:15px 25px; text-align:center;\n                      text-decoration:none; display:inline-block; font-size:16px; margin:5px; border-radius:5px;\">\n               Amazon Link\n            </a>` : \"\"}\n            \n            ${product.walmart_url ? `<a href=\"${product.walmart_url}\"\n               style=\"background-color:#0071CE; color:white; padding:15px 25px; text-align:center;\n                      text-decoration:none; display:inline-block; font-size:16px; margin:5px; border-radius:5px;\">\n               Walmart Link\n            </a>` : \"\"}\n            \n            <p style=\"font-size:18px; margin-top:40px; margin-bottom: 10px;\">\n              $${product.price} EA, MOQ ${product.moq}, ${product.qty} Available.\n            </p>\n            <p style=\"font-size:18px; margin-bottom: 10px;\">ASIN: ${product.asin}</p>\n            <p style=\"font-size:18px; margin-bottom: 10px;\">FOB: ${product.fob}</p>\n            <p style=\"font-size:18px; margin-bottom: 20px;\">Lead Time: ${product.lead_time}</p>\n        </div>\n    </div>\n  `;\n}\n\n/**\r\n * ‚úÖ Send Individual Emails & Ensure last_sent is updated correctly\r\n */\nexport async function sendIndividualEmails(selectedProducts) {\n  if (!selectedProducts || selectedProducts.length === 0) {\n    console.error(\"No products selected for individual email.\");\n    return;\n  }\n  for (const product of selectedProducts) {\n    if (!(product !== null && product !== void 0 && product.id)) {\n      console.error(\"Skipping product with no ID:\", product);\n      continue;\n    }\n    const localUrl = `http://127.0.0.1:8000/products/${product.id}/send-email/`;\n    console.log(`üîπ Sending individual email via FastAPI: POST ${localUrl}`);\n    try {\n      const emailData = {\n        subject: product.title,\n        content: buildPythonStyleEmail(product),\n        // ‚úÖ Ensures proper formatting\n        public: false,\n        email_template_id: null // ‚úÖ Matches Python implementation\n      };\n      console.log(\"\\nüîç DEBUG: Payload being sent to Kit API:\");\n      console.log(JSON.stringify(emailData, null, 2)); // ‚úÖ Pretty-print JSON\n\n      const response = await fetch(localUrl, {\n        method: \"POST\",\n        headers: new Headers({\n          \"Accept\": \"application/json\",\n          \"Content-Type\": \"application/json\",\n          \"X-Kit-Api-Key\": API_KEY\n        }),\n        body: JSON.stringify(emailData)\n      });\n      if (!response.ok) {\n        const errText = await response.text();\n        console.error(`‚ùå Failed to send single email for ID ${product.id}:`, errText);\n      } else {\n        const data = await response.json();\n        console.log(`‚úÖ Email & last_sent updated for ID ${product.id}:`, data);\n      }\n    } catch (error) {\n      console.error(\"‚ùå Network error sending single email:\", error);\n    }\n  }\n}\n\n/**\r\n * ‚úÖ Send Group Email & Ensure last_sent is updated correctly\r\n */\nexport async function sendGroupEmail(selectedProducts) {\n  if (!selectedProducts || selectedProducts.length === 0) {\n    console.error(\"No products selected for group email.\");\n    return;\n  }\n  const productIds = selectedProducts.map(p => p.id).filter(Boolean);\n  if (!productIds.length) {\n    console.error(\"Skipping group email, invalid product IDs.\");\n    return;\n  }\n  const localUrl = \"http://127.0.0.1:8000/products/send-group-email/\";\n  console.log(`üîπ Sending group email via FastAPI: POST ${localUrl}`, productIds);\n  const emailData = {\n    subject: `Group Deal: ${selectedProducts.length} Products Available!`,\n    content: selectedProducts.map(buildPythonStyleEmail).join(\"<hr>\"),\n    // ‚úÖ Ensures full HTML formatting\n    public: false,\n    email_template_id: null // ‚úÖ Matches Python implementation\n  };\n  try {\n    console.log(\"\\nüîç DEBUG: Payload being sent to Kit API:\");\n    console.log(JSON.stringify(emailData, null, 2)); // Pretty-print JSON\n\n    const response = await fetch(localUrl, {\n      method: \"POST\",\n      headers: {\n        \"Accept\": \"application/json\",\n        \"Content-Type\": \"application/json\",\n        \"X-Kit-Api-Key\": API_KEY\n      },\n      body: JSON.stringify(emailData)\n    });\n    if (!response.ok) {\n      const errText = await response.text();\n      console.error(\"‚ùå Failed to send group email:\", errText);\n    } else {\n      const data = await response.json();\n      console.log(`‚úÖ Group email & last_sent updated for IDs ${productIds}:`, data);\n    }\n  } catch (error) {\n    console.error(\"‚ùå Network error sending group email:\", error);\n  }\n}","map":{"version":3,"names":["axios","updateProduct","API_URL","API_KEY","headers","Accept","buildPythonStyleEmail","product","title","image_url","amazon_url","walmart_url","price","moq","qty","asin","fob","lead_time","sendIndividualEmails","selectedProducts","length","console","error","id","localUrl","log","emailData","subject","content","public","email_template_id","JSON","stringify","response","fetch","method","Headers","body","ok","errText","text","data","json","sendGroupEmail","productIds","map","p","filter","Boolean","join"],"sources":["C:/Users/josep/Documents/NPP_Deals/frontend/src/emailSender.js"],"sourcesContent":["import axios from \"axios\";\r\nimport { updateProduct } from \"./api\"; // ‚úÖ Ensures last_sent tracking works\r\n\r\nconst API_URL = \"https://api.kit.com/v4/broadcasts\";\r\nconst API_KEY = \"kit_a0a183e8fd744ca557d96126e488ae22\";\r\n\r\nconst headers = {\r\n  Accept: \"application/json\",\r\n  \"Content-Type\": \"application/json\",\r\n  \"X-Kit-Api-Key\": API_KEY,\r\n};\r\n\r\n/**\r\n * ‚úÖ Build the HTML Email EXACTLY Like Python Code\r\n */\r\nfunction buildPythonStyleEmail(product) {\r\n  return `\r\n    <div style='padding: 20px 0;'>\r\n        <div style=\"text-align:center; margin-bottom: 60px;\">\r\n            <h2 style=\"font-size:18px; margin-bottom: 20px;\">${product.title}</h2>\r\n            <img src=\"${product.image_url}\" alt=\"${product.title}\"\r\n                 style=\"max-width:300px; max-height:300px; width:auto; height:auto; object-fit:contain;\r\n                        display:block; margin-left:auto; margin-right:auto; margin-top:40px; margin-bottom:40px;\"/>\r\n            \r\n            ${product.amazon_url ? `<a href=\"${product.amazon_url}\"\r\n               style=\"background-color:#FF9900; color:white; padding:15px 25px; text-align:center;\r\n                      text-decoration:none; display:inline-block; font-size:16px; margin:5px; border-radius:5px;\">\r\n               Amazon Link\r\n            </a>` : \"\"}\r\n            \r\n            ${product.walmart_url ? `<a href=\"${product.walmart_url}\"\r\n               style=\"background-color:#0071CE; color:white; padding:15px 25px; text-align:center;\r\n                      text-decoration:none; display:inline-block; font-size:16px; margin:5px; border-radius:5px;\">\r\n               Walmart Link\r\n            </a>` : \"\"}\r\n            \r\n            <p style=\"font-size:18px; margin-top:40px; margin-bottom: 10px;\">\r\n              $${product.price} EA, MOQ ${product.moq}, ${product.qty} Available.\r\n            </p>\r\n            <p style=\"font-size:18px; margin-bottom: 10px;\">ASIN: ${product.asin}</p>\r\n            <p style=\"font-size:18px; margin-bottom: 10px;\">FOB: ${product.fob}</p>\r\n            <p style=\"font-size:18px; margin-bottom: 20px;\">Lead Time: ${product.lead_time}</p>\r\n        </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * ‚úÖ Send Individual Emails & Ensure last_sent is updated correctly\r\n */\r\nexport async function sendIndividualEmails(selectedProducts) {\r\n  if (!selectedProducts || selectedProducts.length === 0) {\r\n    console.error(\"No products selected for individual email.\");\r\n    return;\r\n  }\r\n\r\n  for (const product of selectedProducts) {\r\n    if (!product?.id) {\r\n      console.error(\"Skipping product with no ID:\", product);\r\n      continue;\r\n    }\r\n\r\n    const localUrl = `http://127.0.0.1:8000/products/${product.id}/send-email/`;\r\n    console.log(`üîπ Sending individual email via FastAPI: POST ${localUrl}`);\r\n\r\n    try {\r\n      const emailData = {\r\n        subject: product.title,\r\n        content: buildPythonStyleEmail(product),  // ‚úÖ Ensures proper formatting\r\n        public: false,\r\n        email_template_id: null  // ‚úÖ Matches Python implementation\r\n      };      \r\n      \r\n      console.log(\"\\nüîç DEBUG: Payload being sent to Kit API:\");\r\n      console.log(JSON.stringify(emailData, null, 2)); // ‚úÖ Pretty-print JSON\r\n      \r\n      const response = await fetch(localUrl, {\r\n        method: \"POST\",\r\n        headers: new Headers({\r\n          \"Accept\": \"application/json\",\r\n          \"Content-Type\": \"application/json\",\r\n          \"X-Kit-Api-Key\": API_KEY\r\n        }),\r\n        body: JSON.stringify(emailData),\r\n      });\r\n      \r\n      if (!response.ok) {\r\n        const errText = await response.text();\r\n        console.error(`‚ùå Failed to send single email for ID ${product.id}:`, errText);\r\n      } else {\r\n        const data = await response.json();\r\n        console.log(`‚úÖ Email & last_sent updated for ID ${product.id}:`, data);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"‚ùå Network error sending single email:\", error);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * ‚úÖ Send Group Email & Ensure last_sent is updated correctly\r\n */\r\nexport async function sendGroupEmail(selectedProducts) {\r\n  if (!selectedProducts || selectedProducts.length === 0) {\r\n    console.error(\"No products selected for group email.\");\r\n    return;\r\n  }\r\n\r\n  const productIds = selectedProducts.map((p) => p.id).filter(Boolean);\r\n  if (!productIds.length) {\r\n    console.error(\"Skipping group email, invalid product IDs.\");\r\n    return;\r\n  }\r\n\r\n  const localUrl = \"http://127.0.0.1:8000/products/send-group-email/\";\r\n  console.log(`üîπ Sending group email via FastAPI: POST ${localUrl}`, productIds);\r\n\r\n  const emailData = {\r\n    subject: `Group Deal: ${selectedProducts.length} Products Available!`,\r\n    content: selectedProducts.map(buildPythonStyleEmail).join(\"<hr>\"), // ‚úÖ Ensures full HTML formatting\r\n    public: false,\r\n    email_template_id: null  // ‚úÖ Matches Python implementation\r\n  };\r\n\r\n  try {\r\n    console.log(\"\\nüîç DEBUG: Payload being sent to Kit API:\");\r\n    console.log(JSON.stringify(emailData, null, 2)); // Pretty-print JSON\r\n\r\n    const response = await fetch(localUrl, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Accept\": \"application/json\",\r\n        \"Content-Type\": \"application/json\",\r\n        \"X-Kit-Api-Key\": API_KEY\r\n      },\r\n      body: JSON.stringify(emailData),\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      const errText = await response.text();\r\n      console.error(\"‚ùå Failed to send group email:\", errText);\r\n    } else {\r\n      const data = await response.json();\r\n      console.log(`‚úÖ Group email & last_sent updated for IDs ${productIds}:`, data);\r\n    }\r\n  } catch (error) {\r\n    console.error(\"‚ùå Network error sending group email:\", error);\r\n  }\r\n}\r\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,aAAa,QAAQ,OAAO,CAAC,CAAC;;AAEvC,MAAMC,OAAO,GAAG,mCAAmC;AACnD,MAAMC,OAAO,GAAG,sCAAsC;AAEtD,MAAMC,OAAO,GAAG;EACdC,MAAM,EAAE,kBAAkB;EAC1B,cAAc,EAAE,kBAAkB;EAClC,eAAe,EAAEF;AACnB,CAAC;;AAED;AACA;AACA;AACA,SAASG,qBAAqBA,CAACC,OAAO,EAAE;EACtC,OAAO;AACT;AACA;AACA,+DAA+DA,OAAO,CAACC,KAAK;AAC5E,wBAAwBD,OAAO,CAACE,SAAS,UAAUF,OAAO,CAACC,KAAK;AAChE;AACA;AACA;AACA,cAAcD,OAAO,CAACG,UAAU,GAAG,YAAYH,OAAO,CAACG,UAAU;AACjE;AACA;AACA;AACA,iBAAiB,GAAG,EAAE;AACtB;AACA,cAAcH,OAAO,CAACI,WAAW,GAAG,YAAYJ,OAAO,CAACI,WAAW;AACnE;AACA;AACA;AACA,iBAAiB,GAAG,EAAE;AACtB;AACA;AACA,iBAAiBJ,OAAO,CAACK,KAAK,YAAYL,OAAO,CAACM,GAAG,KAAKN,OAAO,CAACO,GAAG;AACrE;AACA,oEAAoEP,OAAO,CAACQ,IAAI;AAChF,mEAAmER,OAAO,CAACS,GAAG;AAC9E,yEAAyET,OAAO,CAACU,SAAS;AAC1F;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA,OAAO,eAAeC,oBAAoBA,CAACC,gBAAgB,EAAE;EAC3D,IAAI,CAACA,gBAAgB,IAAIA,gBAAgB,CAACC,MAAM,KAAK,CAAC,EAAE;IACtDC,OAAO,CAACC,KAAK,CAAC,4CAA4C,CAAC;IAC3D;EACF;EAEA,KAAK,MAAMf,OAAO,IAAIY,gBAAgB,EAAE;IACtC,IAAI,EAACZ,OAAO,aAAPA,OAAO,eAAPA,OAAO,CAAEgB,EAAE,GAAE;MAChBF,OAAO,CAACC,KAAK,CAAC,8BAA8B,EAAEf,OAAO,CAAC;MACtD;IACF;IAEA,MAAMiB,QAAQ,GAAG,kCAAkCjB,OAAO,CAACgB,EAAE,cAAc;IAC3EF,OAAO,CAACI,GAAG,CAAC,iDAAiDD,QAAQ,EAAE,CAAC;IAExE,IAAI;MACF,MAAME,SAAS,GAAG;QAChBC,OAAO,EAAEpB,OAAO,CAACC,KAAK;QACtBoB,OAAO,EAAEtB,qBAAqB,CAACC,OAAO,CAAC;QAAG;QAC1CsB,MAAM,EAAE,KAAK;QACbC,iBAAiB,EAAE,IAAI,CAAE;MAC3B,CAAC;MAEDT,OAAO,CAACI,GAAG,CAAC,4CAA4C,CAAC;MACzDJ,OAAO,CAACI,GAAG,CAACM,IAAI,CAACC,SAAS,CAACN,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;;MAEjD,MAAMO,QAAQ,GAAG,MAAMC,KAAK,CAACV,QAAQ,EAAE;QACrCW,MAAM,EAAE,MAAM;QACd/B,OAAO,EAAE,IAAIgC,OAAO,CAAC;UACnB,QAAQ,EAAE,kBAAkB;UAC5B,cAAc,EAAE,kBAAkB;UAClC,eAAe,EAAEjC;QACnB,CAAC,CAAC;QACFkC,IAAI,EAAEN,IAAI,CAACC,SAAS,CAACN,SAAS;MAChC,CAAC,CAAC;MAEF,IAAI,CAACO,QAAQ,CAACK,EAAE,EAAE;QAChB,MAAMC,OAAO,GAAG,MAAMN,QAAQ,CAACO,IAAI,CAAC,CAAC;QACrCnB,OAAO,CAACC,KAAK,CAAC,wCAAwCf,OAAO,CAACgB,EAAE,GAAG,EAAEgB,OAAO,CAAC;MAC/E,CAAC,MAAM;QACL,MAAME,IAAI,GAAG,MAAMR,QAAQ,CAACS,IAAI,CAAC,CAAC;QAClCrB,OAAO,CAACI,GAAG,CAAC,sCAAsClB,OAAO,CAACgB,EAAE,GAAG,EAAEkB,IAAI,CAAC;MACxE;IACF,CAAC,CAAC,OAAOnB,KAAK,EAAE;MACdD,OAAO,CAACC,KAAK,CAAC,uCAAuC,EAAEA,KAAK,CAAC;IAC/D;EACF;AACF;;AAEA;AACA;AACA;AACA,OAAO,eAAeqB,cAAcA,CAACxB,gBAAgB,EAAE;EACrD,IAAI,CAACA,gBAAgB,IAAIA,gBAAgB,CAACC,MAAM,KAAK,CAAC,EAAE;IACtDC,OAAO,CAACC,KAAK,CAAC,uCAAuC,CAAC;IACtD;EACF;EAEA,MAAMsB,UAAU,GAAGzB,gBAAgB,CAAC0B,GAAG,CAAEC,CAAC,IAAKA,CAAC,CAACvB,EAAE,CAAC,CAACwB,MAAM,CAACC,OAAO,CAAC;EACpE,IAAI,CAACJ,UAAU,CAACxB,MAAM,EAAE;IACtBC,OAAO,CAACC,KAAK,CAAC,4CAA4C,CAAC;IAC3D;EACF;EAEA,MAAME,QAAQ,GAAG,kDAAkD;EACnEH,OAAO,CAACI,GAAG,CAAC,4CAA4CD,QAAQ,EAAE,EAAEoB,UAAU,CAAC;EAE/E,MAAMlB,SAAS,GAAG;IAChBC,OAAO,EAAE,eAAeR,gBAAgB,CAACC,MAAM,sBAAsB;IACrEQ,OAAO,EAAET,gBAAgB,CAAC0B,GAAG,CAACvC,qBAAqB,CAAC,CAAC2C,IAAI,CAAC,MAAM,CAAC;IAAE;IACnEpB,MAAM,EAAE,KAAK;IACbC,iBAAiB,EAAE,IAAI,CAAE;EAC3B,CAAC;EAED,IAAI;IACFT,OAAO,CAACI,GAAG,CAAC,4CAA4C,CAAC;IACzDJ,OAAO,CAACI,GAAG,CAACM,IAAI,CAACC,SAAS,CAACN,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;;IAEjD,MAAMO,QAAQ,GAAG,MAAMC,KAAK,CAACV,QAAQ,EAAE;MACrCW,MAAM,EAAE,MAAM;MACd/B,OAAO,EAAE;QACP,QAAQ,EAAE,kBAAkB;QAC5B,cAAc,EAAE,kBAAkB;QAClC,eAAe,EAAED;MACnB,CAAC;MACDkC,IAAI,EAAEN,IAAI,CAACC,SAAS,CAACN,SAAS;IAChC,CAAC,CAAC;IAEF,IAAI,CAACO,QAAQ,CAACK,EAAE,EAAE;MAChB,MAAMC,OAAO,GAAG,MAAMN,QAAQ,CAACO,IAAI,CAAC,CAAC;MACrCnB,OAAO,CAACC,KAAK,CAAC,+BAA+B,EAAEiB,OAAO,CAAC;IACzD,CAAC,MAAM;MACL,MAAME,IAAI,GAAG,MAAMR,QAAQ,CAACS,IAAI,CAAC,CAAC;MAClCrB,OAAO,CAACI,GAAG,CAAC,6CAA6CmB,UAAU,GAAG,EAAEH,IAAI,CAAC;IAC/E;EACF,CAAC,CAAC,OAAOnB,KAAK,EAAE;IACdD,OAAO,CAACC,KAAK,CAAC,sCAAsC,EAAEA,KAAK,CAAC;EAC9D;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}